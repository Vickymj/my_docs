---
id: alembic_async
title: Alembic Async Setup
---


Alembic is a lightweight database migration tool for SQLAlchemy with async support.

---

## ðŸ“¦ Setup (Async)
```bash
alembic init alembic
alembic init -t async <script_directory>
```
- Creates an `alembic` directory and `alembic.ini`.

### Configure `alembic.ini`
```ini
sqlalchemy.url = postgresql+asyncpg://user:password@localhost/dbname
```

### Configure `env.py`
```python
import asyncio
from logging.config import fileConfig
from sqlalchemy.ext.asyncio import create_async_engine
from alembic import context
from myapp.db import Base

config = context.config
fileConfig(config.config_file_name)
target_metadata = Base.metadata

def run_migrations_offline():
    context.configure(url=config.get_main_option("sqlalchemy.url"), target_metadata=target_metadata, literal_binds=True)
    with context.begin_transaction():
        context.run_migrations()

async def run_migrations_online():
    connectable = create_async_engine(config.get_main_option("sqlalchemy.url"), future=True, echo=True)
    async with connectable.connect() as connection:
        await connection.run_sync(lambda conn: context.configure(connection=conn, target_metadata=target_metadata))
        await connection.run_sync(lambda conn: context.run_migrations())

if context.is_offline_mode():
    run_migrations_offline()
else:
    asyncio.run(run_migrations_online())
```

---

## ðŸ”„ Migration Commands

### Create a New Revision
```bash
alembic revision -m "create users table"
```

### Autogenerate Revision
```bash
alembic revision --autogenerate -m "add email column to users"
```

### Upgrade to Latest
```bash
alembic upgrade head
```

### Downgrade
```bash
alembic downgrade -1
```

### Show History
```bash
alembic history
```

### Current Revision
```bash
alembic current
```

---

## âš¡ Tips
- Use `asyncpg` or another async driver.
- Always check autogenerated migrations before applying.
- Use `--sql` to preview SQL.
